# OpenAPI 3 Client Extension

Chrome拡張機能として動作するOpenAPI 3.x仕様対応のAPIクライアント

## 特徴

### 主な機能
- **OpenAPI 3.x仕様解析**: JSON/YAMLファイルやURLから仕様を読み込み
- **環境管理**: 複数の環境（開発、ステージング等）を管理
- **リクエスト機能**: 
  - パラメータ自動入力支援
  - カスタムクエリパラメータ追加
  - 任意のURLパス実行
- **レスポンス表示**: ステータス、ヘッダー、ボディの詳細表示
- **履歴管理**: リクエスト履歴の保存と再実行
- **ダークモード**: フル対応のダークテーマ
- **カスタマイズ**: パネル幅の調整と設定保持

### UI特徴
- **Podman風UI**: リクエストとレスポンスを統合表示
- **レスポンシブデザイン**: 画面サイズに応じたレイアウト調整
- **コピー機能**: URL、レスポンスヘッダー、ボディのワンクリックコピー
- **ダークモード**: TailwindCSSによる完全対応

## 技術構成

### フロントエンド技術
- **フレームワーク**: React 18 + TypeScript
- **ビルドツール**: Vite + CRXJS Vite Plugin
- **スタイリング**: TailwindCSS
- **状態管理**: React Context API
- **ストレージ**: Chrome Storage API
- **OpenAPI解析**: js-yaml + カスタムパーサー

### アーキテクチャ構成

#### ディレクトリ構造
```
src/
├── background/          # Service Worker
├── options/            # メインアプリケーション
│   └── components/     # Reactコンポーネント
├── context/            # React Context状態管理
├── hooks/              # カスタムフック
├── lib/                # コアライブラリ
│   ├── openapi.ts      # OpenAPI解析
│   ├── request.ts      # HTTPリクエスト
│   └── utils.ts        # ユーティリティ
├── types/              # TypeScript型定義
└── styles/             # スタイルファイル
```

#### 主要コンポーネント
- **NewApp**: アプリケーションルート
- **Sidebar**: API仕様一覧、環境選択（リサイズ可能）
- **RequestPanel**: リクエスト設定パネル
- **ResponsePanel**: レスポンス表示パネル（折りたたみ対応）
- **HistoryPanel**: リクエスト履歴管理

### OpenAPI機能

#### $ref参照解決
- **循環参照対応**: 無限ループ防止機能
- **深度制限**: 最大50レベルまで解決
- **キャッシュ機能**: 解決済み参照の再利用

#### パラメータ管理
- **型サポート**: string, number, boolean, enum対応
- **バリデーション**: 必須パラメータチェック
- **パスパラメータ**: URLの`{id}`等を自動抽出
- **クエリパラメータ**: OpenAPI仕様とカスタム両対応

#### カスタム機能
```typescript
// サポートする入力形式
- string: テキスト入力
- number/integer: 数値入力（step="any"対応）
- boolean: true/false選択
- enum: ドロップダウン選択
- array: JSON配列入力（自動フォーマット）
```

## 開発

### 環境構築
```bash
# 依存関係インストール
npm install

# 開発モード
npm run dev

# ビルド
npm run build

# 型チェック
npm run type-check
```

### Chrome拡張機能のインストール
1. `npm run build`でビルド実行
2. Chromeで chrome://extensions/ を開く
3. 「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. `dist`フォルダを選択

## 使用方法

### 基本的な流れ

#### 1. API仕様の読み込み
- **ファイル**: JSON/YAMLファイルをドラッグ&ドロップ
- **URL**: OpenAPI仕様のURL入力

#### 2. 環境設定
- **ベースURL**: API サーバーのベースURL設定
- **ヘッダー**: 認証情報等の共通ヘッダー

#### 3. エンドポイント選択
- サイドバーからAPI仕様を展開
- 実行したいエンドポイントをクリック

#### 4. リクエスト設定
- **パスパラメータ**: 必要な値を入力
- **クエリパラメータ**: 値を選択・入力
- **カスタムパラメータ**: 任意のパラメータ追加
- **リクエストボディ**: JSON形式でデータ入力

#### 5. リクエスト実行
- パス入力フィールド右側の「Send」ボタンをクリック
- リアルタイムでレスポンス表示

### 高度な機能

#### カスタムURL実行
URL入力フィールドに任意のパスとクエリパラメータを入力可能

#### パネルリサイズ
- **サイドバー**: 右端をドラッグして幅調整（200px-600px）
- **リクエスト/レスポンス**: 境界線をドラッグして分割比率調整（20%-80%）
- **設定保持**: リロード後も幅設定を保持

#### 履歴機能
- **自動保存**: 実行したリクエストを自動保存
- **詳細表示**: パラメータ、ヘッダー、ボディの完全な記録
- **再実行**: 履歴からワンクリック再実行
- **互換性**: コード更新時の履歴データ互換性対応

## トラブルシューティング

### よくある問題

#### パラメータが表示されない場合
1. **原因**:
   ```javascript
   // 仕様の確認
   console.log(parameterSchema?.query) // undefined の場合
   ```

2. **解決法**:
   - OpenAPI仕様で`components.parameters`に正しく定義されているか確認
   - `$ref`参照が正しく解決されているか確認
   - YAML仕様の文法エラーがないか確認

#### $ref参照エラー
```
❌ Reference path not found: #/components/parameters/Ids
```
**解決法**: 参照先が仕様ファイル内に正しく定義されているか確認

#### 循環参照警告
```
⚠️ Circular reference detected: #/components/schemas/CircularSchema
```
**対応**: 自動的に循環を回避して処理継続

### パフォーマンス

#### メモリ使用量
- **小規模API** (< 100エンドポイント): ~5MB
- **中規模API** (100-500エンドポイント): ~15MB  
- **大規模API** (500+ エンドポイント): ~30MB

#### 最適化機能
- **遅延レンダリング**: 大量エンドポイントの段階表示
- **メモ化**: React.memo、useMemo、useCallbackによる最適化
- **Tree shaking**: 未使用コードの自動除去

## 貢献

### 開発参加方法

#### Issue報告
バグ報告や機能要望の際は以下を含めてください：
- Chrome バージョン
- 拡張機能バージョン
- 再現手順
- 期待する動作
- エラーメッセージ

#### プルリクエスト
1. Forkして開発ブランチを作成
2. 機能実装・バグ修正
3. テスト実行
4. プルリクエスト作成

## ライセンス
MIT License

## 開発者
Built with Claude Code Assistant  
Developed by Marimelon

---

## 更新履歴

### v1.0.0 (現在)
- ✅ OpenAPI 3.x仕様対応
- ✅ $ref参照解決（循環参照対応）
- ✅ パスパラメータ・クエリパラメータ設定
- ✅ カスタムURL・パラメータ機能
- ✅ Podman風UI設計
- ✅ リクエスト履歴機能
- ✅ 環境管理機能
- ✅ ダークモード完全対応
- ✅ パネルリサイズ機能
- ✅ コピー機能（フィードバック付き）
- ✅ Chrome Storage API連携
- ✅ 履歴データ互換性対応

### 今後の予定
- 🔄 Bearer Token認証
- 🔄 ファイルアップロード機能
- 🔄 環境変数管理
- 🔄 リクエストのcurl、JavaScript出力
- 🔄 GraphQL対応
